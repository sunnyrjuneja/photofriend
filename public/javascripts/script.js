// Generated by CoffeeScript 1.6.2
(function() {
  $(function() {
    var iosocket, send_message;

    iosocket = io.connect();
    iosocket.on('connect', function() {
      return iosocket.on('new image', function(name) {
        console.log("name");
        return $('#images').append('<div class="img-crop"><img src="/uploads/' + name + '></div>');
      });
    });
    send_message = function(message) {
      $('div.progress').hide();
      $('strong.message').text(message);
      return $('div.alert').show();
    };
    return $('input[type="submit"]').on('click', function(evt) {
      var file, formData, xhr;

      evt.preventDefault();
      $('div.progress').show();
      formData = new FormData;
      file = $('#user-file')[0].files[0];
      formData.append('image', file);
      xhr = new XMLHttpRequest();
      xhr.open('post', '/', true);
      xhr.upload.onprogress = function(e) {
        var percentage;

        if (e.lengthComputable) {
          percentage = (e.loaded / e.total) * 100;
          return $('div.progress div.bar').css('width', percentage + '%');
        }
      };
      xhr.onerror = function(e) {
        return send_message('An error occured while uploading your image. Make sure your image is no larger than 2 mb.');
      };
      xhr.onload = function() {
        return send_message(this.statusText);
      };
      xhr.send(formData);
      return this.form.reset();
    });
  });

}).call(this);
